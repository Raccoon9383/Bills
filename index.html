<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SplitMate</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-blue: #003c83;
      --primary-yellow: #ffe00f;
      --soft-blue: #e8f0ff;
      --card-bg: #ffffff;
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: linear-gradient(to bottom right, var(--soft-blue), #fdfdfd);
      padding: 20px;
      margin: 0;
      max-width: 720px;
      margin: 0 auto;
    }

    h2 {
      text-align: center;
      font-size: 2.2rem;
      color: var(--primary-blue);
      margin-bottom: 20px;
      font-weight: 700;
    }

    .section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      transition: all 0.3s ease;
    }

    label, input, button {
      display: inline-block;
      font-size: 1rem;
      margin: 6px 4px 10px 0;
    }

    input[type="text"],
    input[type="number"] {
      padding: 10px;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      transition: border 0.3s;
    }

    input:focus {
      border: 1px solid var(--primary-blue);
      outline: none;
    }

    button {
      background-color: var(--primary-blue);
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #002c63;
    }

    .results {
      background: #f0f7ff;
      padding: 15px;
      border-radius: 10px;
      font-size: 1rem;
      color: #222;
      white-space: pre-wrap;
    }

    .item { font-size: 1rem; margin: 5px 0; }
    .item button { color: red; margin-left: 8px; }

    .person-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 10px;
      gap: 10px;
    }

    .person-row label {
      font-weight: bold;
      flex: 1 0 100%;
    }

    .person-row input[type="number"] {
      width: 60px;
      padding: 6px;
    }

    .total-display {
      margin-top: 10px;
      font-weight: 600;
      color: var(--primary-blue);
      font-size: 1rem;
    }

    @media (max-width: 480px) {
      h2 { font-size: 1.6rem; }
      button { padding: 8px 14px; font-size: 0.95rem; }
      input { font-size: 0.95rem; }
    }
  </style>
</head>
<body>
  <h2>SplitMate</h2>

  <div class="section">
    <label>📦 1단계: 영수증 항목 입력</label><br>
    <input type="text" id="itemName" placeholder="항목명 (예: 치킨, 소주)">
    <input type="number" id="itemCount" placeholder="수량">
    <input type="number" id="itemPrice" placeholder="개당 가격">
    <button onclick="addItem()">항목 추가</button>
    <div id="itemList"></div>
    <div class="total-display" id="receiptTotalDisplay"></div>
  </div>

  <div class="section">
    <label>👥 2단계: 참여자 이름 입력</label><br>
    <input type="text" id="personName" placeholder="이름">
    <button onclick="addPerson()">이름 추가</button>
    <div id="personList"></div>
  </div>

  <div class="section" id="selectionSection" style="display:none">
    <label>✅ 3단계: 각자 먹은 항목 수량 입력</label>
    <div id="selectionArea"></div>
    <button onclick="calculate()">정산 완료</button>
  </div>

  <div class="section">
    <div class="results" id="results"></div>
  </div>

  <script>
    const items = [];
    const people = [];

    function formatNumber(num) {
      return num.toLocaleString('ko-KR');
    }

    function addItem() {
      const name = document.getElementById('itemName').value;
      const count = parseInt(document.getElementById('itemCount').value);
      const price = parseInt(document.getElementById('itemPrice').value);
      if (!name || isNaN(count) || isNaN(price)) return alert('모든 항목을 입력해주세요.');
      items.push({ name, count, price });
      document.getElementById('itemName').value = '';
      document.getElementById('itemCount').value = '';
      document.getElementById('itemPrice').value = '';
      updateItemList();
      renderSelectionArea();
    }

    function removeItem(index) {
      items.splice(index, 1);
      updateItemList();
      renderSelectionArea();
    }

    function updateItemList() {
      const list = document.getElementById('itemList');
      list.innerHTML = items.map((item, i) =>
        `<div class="item">${item.name} - ${item.count}개 × ₩${formatNumber(item.price)} <button onclick="removeItem(${i})">❌</button></div>`
      ).join('');
      updateReceiptTotal();
    }

    function updateReceiptTotal() {
      const total = items.reduce((sum, item) => sum + item.count * item.price, 0);
      document.getElementById('receiptTotalDisplay').textContent = `영수증 총액: ₩${formatNumber(total)}`;
    }

    function addPerson() {
      const name = document.getElementById('personName').value;
      if (!name) return alert('이름을 입력해주세요.');
      people.push({ name, consumed: {} });
      document.getElementById('personName').value = '';
      updatePersonList();
      renderSelectionArea();
    }

    function updatePersonList() {
      document.getElementById('personList').innerHTML = people.map(p => `• ${p.name}`).join('<br>');
    }

    function renderSelectionArea() {
      if (people.length === 0 || items.length === 0) return;
      document.getElementById('selectionSection').style.display = 'block';
      const area = document.getElementById('selectionArea');
      area.innerHTML = '';
      people.forEach((person, pIdx) => {
        const row = document.createElement('div');
        row.className = 'person-row';
        const nameLabel = document.createElement('label');
        nameLabel.textContent = person.name;
        row.appendChild(nameLabel);

        items.forEach((item, iIdx) => {
          const input = document.createElement('input');
          input.type = 'number';
          input.min = '0';
          input.placeholder = item.name;
          input.oninput = (e) => {
            const val = parseInt(e.target.value);
            if (!isNaN(val) && val > 0) person.consumed[item.name] = val;
            else delete person.consumed[item.name];
          };
          row.appendChild(input);
        });
        area.appendChild(row);
      });
    }

    function toFraction(numerator, denominator) {
      return numerator + '/' + denominator;
    }

    function calculate() {
      const itemMap = {};
      items.forEach(item => itemMap[item.name] = { ...item, consumerList: [], totalQty: 0 });

      const totals = {};
      const consumedItems = {};
      const itemConsumers = {};
      people.forEach(p => {
        totals[p.name] = 0;
        consumedItems[p.name] = [];
        for (const [itemName, qty] of Object.entries(p.consumed)) {
          if (!itemMap[itemName]) continue;
          itemMap[itemName].consumerList.push({ name: p.name, qty });
          itemMap[itemName].totalQty += qty;
          if (!itemConsumers[itemName]) itemConsumers[itemName] = [];
          itemConsumers[itemName].push(p.name);
        }
      });

      let calculatedTotal = 0;
      for (const item of Object.values(itemMap)) {
        const totalCost = item.count * item.price;
        const totalConsumedQty = item.totalQty;
        if (totalConsumedQty === 0) continue;
        const unitShare = totalCost / totalConsumedQty;

        for (const consumer of item.consumerList) {
          const personShare = unitShare * consumer.qty;
          totals[consumer.name] += personShare;
          calculatedTotal += personShare;
          const fraction = toFraction(consumer.qty, totalConsumedQty);
          consumedItems[consumer.name].push(`${item.name} x${fraction}`);
        }
      }

      const receiptTotal = items.reduce((sum, item) => sum + item.count * item.price, 0);
      const resultLines = [`✅ 정산 결과 (총액: ₩${formatNumber(Math.round(calculatedTotal))} / 영수증 총액: ₩${formatNumber(receiptTotal)})\n`];

      for (const name in totals) {
        const itemsList = consumedItems[name].join(', ');
        resultLines.push(`${name}: ₩${formatNumber(Math.round(totals[name]))} (${itemsList})`);
      }

      resultLines.push('\n👥 항목별 참여자 목록');
      for (const item in itemConsumers) {
        resultLines.push(`${item}: (${itemConsumers[item].join(', ')})`);
      }

      document.getElementById('results').textContent = resultLines.join('\n');
    }
  </script>
</body>
</html>